<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Analytics - SmartPJU Monitor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
    />
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#4a9eff",
              dark: {
                100: "#1a1f2e",
                200: "#0f1419",
              },
              light: {
                100: "#f5f7fa",
                200: "#e4e9f0",
              },
            },
          },
        },
      };
    </script>
    <style type="text/tailwindcss">
      @layer components {
        .stat-card {
          @apply bg-dark-100/80 border border-white/10 rounded-xl p-4 sm:p-6 
                 transition-all hover:-translate-y-1 hover:shadow-2xl 
                 hover:shadow-primary/20 hover:border-primary/30;
        }
      }

      /* Light theme styles */
      .light body {
        @apply bg-gradient-to-br from-gray-50 via-white to-gray-100 text-gray-900;
      }

      .light nav,
      .light aside,
      .light #hamburger-btn {
        @apply bg-white/95 border-gray-200;
      }

      .light .bg-dark-100\/80,
      .light .bg-white\/5 {
        @apply bg-white shadow-md;
      }

      .light .bg-dark-200\/95 {
        @apply bg-white/95;
      }

      .light .text-gray-400 {
        @apply text-gray-600;
      }

      .light .text-gray-200,
      .light .text-white {
        @apply text-gray-900;
      }

      .light .border-white\/10 {
        @apply border-gray-200;
      }

      .light #hamburger-btn span {
        @apply bg-primary;
      }

      /* Grafana iframe styling */
      .grafana-container {
        position: relative;
        width: 100%;
        height: calc(100vh - 120px);
        min-height: 600px;
      }

      .grafana-container iframe {
        border: none;
        border-radius: 12px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      }
    </style>
  </head>
  <body
    class="bg-gradient-to-br from-dark-200 via-dark-100 to-dark-200 min-h-screen text-gray-200 transition-colors duration-300"
  >
    <!-- Navbar -->
    <nav
      class="fixed top-0 left-0 right-0 z-50 bg-dark-100/95 backdrop-blur-md border-b border-white/10"
    >
      <div class="w-full px-3 sm:px-4 lg:container lg:mx-auto">
        <div class="flex items-center justify-between h-16">
          <!-- Left side - Hamburger + Logo -->
          <div class="flex items-center gap-2 sm:gap-3 lg:gap-4">
            <button
              class="lg:hidden bg-white/5 border border-white/10 rounded-lg p-2 hover:bg-primary/20 hover:border-primary transition-all"
              id="hamburger-btn"
            >
              <div class="w-5 h-4 flex flex-col justify-between">
                <span
                  class="block w-full h-0.5 bg-primary rounded transition-all duration-300"
                ></span>
                <span
                  class="block w-full h-0.5 bg-primary rounded transition-all duration-300"
                ></span>
                <span
                  class="block w-full h-0.5 bg-primary rounded transition-all duration-300"
                ></span>
              </div>
            </button>

            <!-- Logos -->
            <img
              src="{{ url_for('static', filename='img/PENS-LOGO.png') }}"
              alt="PENS Logo"
              class="h-8 sm:h-9 lg:h-10 w-auto"
            />
            <img
              src="{{ url_for('static', filename='img/pemkot.png') }}"
              alt="Pemkot Logo"
              class="h-8 sm:h-9 lg:h-10 w-auto"
            />
            <div class="hidden md:block">
              <h1 class="text-white text-lg font-semibold">SmartPJU Monitor</h1>
              <p class="text-gray-400 text-xs">
                Vehicle Traffic Detection System
              </p>
            </div>
          </div>

          <!-- Right side - Theme Toggle -->
          <div class="flex items-center">
            <button
              id="theme-toggle"
              class="p-2 sm:p-2.5 rounded-lg bg-white/5 border border-white/10 hover:bg-white/10 hover:border-primary transition-all"
              title="Toggle Theme"
            >
              <i
                class="bi bi-sun-fill text-lg sm:text-xl text-yellow-400 hidden"
                id="light-icon"
              ></i>
              <i
                class="bi bi-moon-stars-fill text-lg sm:text-xl text-blue-400"
                id="dark-icon"
              ></i>
            </button>
          </div>
        </div>
      </div>
    </nav>

    <!-- Sidebar Overlay -->
    <div
      class="fixed inset-0 bg-black/50 z-40 hidden lg:hidden"
      id="sidebar-overlay"
    ></div>

    <div class="flex min-h-screen">
      <!-- Sidebar -->
      <aside
        class="fixed lg:static w-64 h-screen bg-dark-200/95 border-r border-white/10 py-8 pt-20 lg:pt-20 z-40 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 overflow-y-auto"
        id="sidebar"
      >
        <div class="px-6 mb-8 flex items-center gap-3">
          <img
            src="{{ url_for('static', filename='img/Logo Si PJU.png') }}"
            alt="Logo PJU"
            class="h-8 w-auto"
          />
          <h4 class="text-white text-xl font-semibold">SmartPJU Monitor</h4>
        </div>
        <ul class="space-y-2">
          <li>
            <a
              href="/"
              class="flex items-center gap-4 px-6 py-3.5 text-gray-400 hover:bg-primary/10 hover:text-primary transition-all border-l-3 border-transparent hover:border-primary"
            >
              <i class="bi bi-grid-fill text-xl w-6"></i>
              <span>Dashboard</span>
            </a>
          </li>
          <li>
            <a
              href="/cctv"
              class="flex items-center gap-4 px-6 py-3.5 text-gray-400 hover:bg-primary/10 hover:text-primary transition-all border-l-3 border-transparent hover:border-primary"
            >
              <i class="bi bi-camera-video-fill text-xl w-6"></i>
              <span>CCTV</span>
            </a>
          </li>
          <li>
            <a
              href="/analytics"
              class="flex items-center gap-4 px-6 py-3.5 bg-primary/15 text-primary border-l-3 border-primary"
            >
              <i class="bi bi-bar-chart-fill text-xl w-6"></i>
              <span>Analytics</span>
            </a>
          </li>
        </ul>
      </aside>

      <!-- Main Content -->
      <main class="flex-1 p-3 pt-20 sm:p-6 sm:pt-24 lg:p-8 lg:pt-24 lg:ml-0">
        <!-- Page Header -->
        <div class="mb-4 sm:mb-6 lg:mb-8">
          <div
            class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 sm:gap-4"
          >
            <div>
              <h1 class="text-2xl sm:text-3xl font-semibold text-white mb-2">
                <i class="bi bi-bar-chart-fill text-primary mr-2"></i>
                Traffic Analytics
              </h1>
              <p class="text-gray-400 text-sm sm:text-base">
                Real-time vehicle traffic statistics and insights
              </p>
            </div>

            <!-- Time Range Info -->
            <div
              class="bg-white/5 px-4 py-2 rounded-lg border border-white/10 text-sm"
            >
              <i class="bi bi-clock text-primary mr-2"></i>
              <span class="text-gray-300">Auto-refresh: 5 seconds</span>
            </div>
          </div>
        </div>

        <!-- Info Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
          <div class="stat-card">
            <div class="flex items-center gap-3">
              <i class="bi bi-graph-up text-2xl text-green-400"></i>
              <div>
                <p class="text-gray-400 text-sm">Status</p>
                <p class="text-white text-lg font-semibold">Live Monitoring</p>
              </div>
            </div>
          </div>

          <div class="stat-card">
            <div class="flex items-center gap-3">
              <i class="bi bi-database text-2xl text-blue-400"></i>
              <div>
                <p class="text-gray-400 text-sm">Data Source</p>
                <p class="text-white text-lg font-semibold">InfluxDB</p>
              </div>
            </div>
          </div>

          <div class="stat-card">
            <div class="flex items-center gap-3">
              <i class="bi bi-eye text-2xl text-purple-400"></i>
              <div>
                <p class="text-gray-400 text-sm">Visualization</p>
                <p class="text-white text-lg font-semibold">Grafana</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Grafana Dashboard Embed -->
        <div
          class="bg-dark-100/80 border border-white/10 rounded-2xl p-4 sm:p-6 shadow-2xl"
        >
          <div class="grafana-container">
            <iframe
              src="http://localhost:3030/d/vehicle-traffic-v2/vehicle-traffic-dashboard-v2?orgId=1&refresh=5s&kiosk=tv"
              width="100%"
              height="100%"
              frameborder="0"
            ></iframe>
          </div>
        </div>

        <!-- Help Text -->
        <div
          class="mt-6 bg-blue-500/10 border border-blue-500/30 rounded-lg p-4 text-sm"
        >
          <i class="bi bi-info-circle text-blue-400 mr-2"></i>
          <strong class="text-blue-300">Tip:</strong>
          <span class="text-gray-300">
            Dashboard akan otomatis refresh setiap 5 detik untuk menampilkan
            data terbaru. Anda dapat berinteraksi dengan grafik dengan zoom,
            pan, dan filter.
          </span>
        </div>
      </main>
    </div>

    <script>
      // Theme Toggle
      const themeToggle = document.getElementById("theme-toggle");
      const lightIcon = document.getElementById("light-icon");
      const darkIcon = document.getElementById("dark-icon");
      const htmlElement = document.documentElement;

      // Load saved theme
      const savedTheme = localStorage.getItem("theme") || "dark";
      if (savedTheme === "light") {
        htmlElement.classList.add("light");
        lightIcon.classList.remove("hidden");
        darkIcon.classList.add("hidden");
      }

      themeToggle.addEventListener("click", () => {
        htmlElement.classList.toggle("light");
        const isLight = htmlElement.classList.contains("light");

        lightIcon.classList.toggle("hidden", !isLight);
        darkIcon.classList.toggle("hidden", isLight);

        localStorage.setItem("theme", isLight ? "light" : "dark");
      });

      // Hamburger Menu
      const hamburgerBtn = document.getElementById("hamburger-btn");
      const sidebar = document.getElementById("sidebar");
      const sidebarOverlay = document.getElementById("sidebar-overlay");

      hamburgerBtn.addEventListener("click", () => {
        sidebar.classList.toggle("-translate-x-full");
        sidebarOverlay.classList.toggle("hidden");
      });

      sidebarOverlay.addEventListener("click", () => {
        sidebar.classList.add("-translate-x-full");
        sidebarOverlay.classList.add("hidden");
      });
    </script>
  </body>
</html>
